<!-- index.wxml -->
<view class="topbar">
  <input class="search-input" placeholder="搜索地址或地点" bindinput="onSearchInput" bindconfirm="onSearchConfirm" value="{{searchQuery}}" />
  <button bindtap="moveToLocation" class="location-button">定位</button>
  <!-- 切换我的地点列表 -->
  <button bindtap="toggleMyLocations" class="my-locations-toggle">我的地点</button>
</view>

<map id="map"
  longitude="{{longitude}}"
  latitude="{{latitude}}"
  scale="{{scale}}"
  markers="{{markers}}"
  show-location
  bindtap="onMapTap"
  bindmarkertap="onMarkerTap"
  bind:callouttap="onMarkerTap"
  class="map-area">
</map>

<!-- 搜索结果下拉 -->
<view class="search-results" wx:if="{{searchQuery && filteredResults.length}}">
  <block wx:for="{{filteredResults}}" wx:key="id">
    <view class="result-item" bindtap="onSelectSearchResult" data-id="{{item.id}}">{{item.title}}</view>
  </block>
</view>

<!-- 已添加地点列表（我的地点） -->
<view class="my-locations-panel" wx:if="{{showMyLocations}}">
  <view class="my-locations-header">已保存地点</view>
  <block wx:for="{{myMarkers}}" wx:key="id">
    <view class="my-location-item" bindtap="onSelectMyLocation" data-id="{{item.id}}">
      <block wx:if="{{item.imageUrl}}">
        <image class="thumb" src="{{item.imageUrl}}" mode="aspectFill" />
      </block>
      <block wx:else>
        <view class="thumb placeholder">无图</view>
      </block>
      <view class="meta">
        <view class="title">{{item.title}}</view>
        <view class="desc">{{item.description ? (item.description.length > 40 ? item.description.slice(0, 40) + '…' : item.description) : (item.title ? (item.title.length > 40 ? item.title.slice(0,40) + '…' : item.title) : '')}}</view>
      </view>
    </view>
  </block>
</view>

<view class="marker-callout" wx:if="{{selectedMarker}}">
  <view class="marker-title">{{selectedMarker.title}}</view>
  <view class="marker-actions">
    <button size="mini" bindtap="editMarker">编辑</button>
    <button size="mini" type="warn" bindtap="deleteMarker">删除</button>
  </view>
</view>